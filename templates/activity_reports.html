<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Beacon Activity Reports</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <style>
    body {
      background:#020617;
      color:#e5e7eb;
      padding:16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    a { color:#60a5fa; text-decoration:none; }
    a:hover { text-decoration:underline; }
    table {
      width:100%;
      border-collapse: collapse;
      margin-top:12px;
      font-size:0.9rem;
    }
    th, td {
      padding:8px 10px;
      border-bottom:1px solid rgba(148,163,184,0.3);
      text-align:left;
    }
    th {
      background:#020617;
      position:sticky;
      top:0;
    }
    .back-link {
      margin-bottom:12px;
      display:inline-block;
    }
    .card {
      background:#020617;
      border-radius:8px;
      border:1px solid rgba(55,65,81,0.9);
      padding:12px 14px;
      margin-bottom:16px;
    }
    .card-title {
      font-size:1rem;
      font-weight:600;
      margin-bottom:8px;
    }
    .card-subtitle {
      font-size:0.85rem;
      color:#9ca3af;
      margin-bottom:8px;
    }
    select, input[type="date"], button {
      padding:6px 8px;
      border-radius:4px;
      border:1px solid #4b5563;
      background:#020617;
      color:#e5e7eb;
    }
    button {
      background:#3b82f6;
      border:none;
      cursor:pointer;
    }
    button:hover {
      background:#2563eb;
    }
    .form-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin-top:4px;
    }
    .form-row label {
      font-size:0.85rem;
    }
  </style>
</head>
<body>
  <a href="/map" class="back-link">‚Üê Back to map</a>

  <!-- Beacon-level reports -->
  <div class="card">
    <div class="card-title">Generate beacon activity report</div>
    <div class="card-subtitle">
      Choose a beacon and optional date range to generate a detailed PDF of its events.
    {% if beacons %}
    <form method="post">
      <input type="hidden" name="report_kind" value="beacon" />
      <div class="form-row">
        <label for="beacon_name">Beacon:</label>
        <select id="beacon_name" name="beacon_id">
          {% for b in beacons %}
          <option value="{{ b.ident }}">{{ b.label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-row" style="margin-top:6px;">
        <label for="start_date">Start date:</label>
        <input type="date" id="start_date" name="start_date" />
        <label for="end_date">End date:</label>
        <input type="date" id="end_date" name="end_date" />
        <button type="submit">Generate beacon report</button>
      </div>
    </form>
    {% else %}
    <p>No notifications have been stored yet, so there are no beacons to report on.</p>
    {% endif %}
  </div>

  <!-- Device-level reports -->
  <div class="card">
    <div class="card-title">Generate device activity report</div>
    <div class="card-subtitle">
      Create a PDF for a device showing all beacons attached to it and their events.
    </div>
    {% if devices %}
    <form method="post">
      <input type="hidden" name="report_kind" value="device" />
      <div class="form-row">
        <label for="device_ident">Device:</label>
        <select id="device_ident" name="device_ident">
          {% for d in devices %}
          <option value="{{ d.ident }}">{{ d.label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-row" style="margin-top:6px;">
        <label for="device_start_date">Start date:</label>
        <input type="date" id="device_start_date" name="start_date" />
        <label for="device_end_date">End date:</label>
        <input type="date" id="device_end_date" name="end_date" />
        <button type="submit">Generate device report</button>
      </div>
    </form>
    {% else %}
    <p class="card-subtitle">
      No devices are currently active. Once a device appears on the map you can generate a device report here.
    </p>
    {% endif %}
  </div>

  <!-- Existing reports list -->
  <div class="card">
    <div class="card-title">Existing activity reports</div>
    {% if reports %}
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Target</th>
          <th>Created at</th>
          <th>Summary</th>
          <th>Download</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reports %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[3] }}</td>
          <td><a href="{{ url_for('download_activity_report', report_id=r[0]) }}">Download</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>No activity reports have been generated yet.</p>
    {% endif %}
  </div>
</body>
</html>